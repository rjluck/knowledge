# 初识

[[toc]]

## 小程序与普通网页开发的区别

（1）运行环境不同
网页运行在浏览器环境中
小程序运行在微信环境中

（2）开发模式不同
网页的开发模式：浏览器+代码编辑器
小程序有自己的一套标准开发模式：
- 申请小程序开发账号
- 安装小程序开发者工具
- 创建和配置小程序项目

（3）API不同
由于运行环境的不同，所以小程序中，无法调用DOM和BOM的API。但是，小程序中可以调用微信环境提供的各种API，例如
- 地理定位
- 扫码
- 支付



## 小程序开发账号

### 注册

> 小程序开发与网页开发不一样，在开始微信小程序开发之前，需要访问【微信公众平台】，注册一个微信小程序账号。
>
> 有了小程序账号以后，我们才可以开发和管理小程序，后续需要通过该账号进行 开发信息的设置、开发成员的添加，也可以用该账号查看小程序的运营数据。

在申请账号前，我们需要先准备一个邮箱，该邮箱要求：
- 未被微信公众平台注册
- 未被微信开放平台注册
- 未被个人微信号绑定过，如果被绑定了需要解绑或使用其它邮箱


浏览器打开[微信公众平台](https://mp.weixin.qq.com),进行注册。

### 完善信息

在完成注册后，需要打开微信公众平台对小程序账号进行一些设置，这是因为小程序在**上线阶段-提交审核**的时候，小程序账号信息是必填项，因此在注册小程序以后，需要补充小程序的基本信息，如名称、图标、类目等。同时需要进行小程序备案和微信认证。
- 小程序信息
- 小程序类目
- 小程序备案
- 微信认证

### 项目成员和体验成员


小程序提供了两种不同的成员角色：项目成员 和 体验成员。

- 项目成员：表示参与小程序开发、运营的成员，包括运营者、开发者及数据分析者，项目成员可以登录微信公众后台，管理员可以在成员管理中添加、删除项目成员，并设置项目成员的角色。
- 体验成员：表示参与小程序内侧体验的成员，可使用体验版小程序，但不属于项目成员。管理员及项目成员均可添加、删除体验成员。




### 小程序开发者ID

微信小程序账号只要开发者满足开发资质都可以进行注册，并且会获得对应的开发者ID

一个完整的开发者ID由小程序ID（`AppID`）和一个小程序秘钥（`AppSecret`）组成。
- `AppID`是小程序在整个微信账号体系内的唯一身份凭证，后续在很多地方都会用到，例如：新建小程序项目、真机调试、发布小程序等操作时，必须有小程序ID。
- `AppSecret`是开发者对小程序拥有所有权的凭证，在进行微信登录、微信支付，或进行发消息等高级开发时会使用到。


获取小程序的AppID途径
- 登录小程序管理后台
- 开发设置即可获取

![image](/imgs/applet/wx/wx1.png)

> 创建项目的时候需要用到AppID






## 了解微信开发者工具

是官方推荐使用的小程序开发工具，它提供的主要功能如下：
- 快速创建小程序项目
- 代码的查看和编辑
- 对小程序功能进行调试
- 小程序的预览和发布



微信开发者工具包含三个版本：
- 稳定版：稳定性高，**开发中一般推荐大家使用稳定版本** 。
- 预发布版：稳定性尚可，一般包含新的、大的特性，通过了内部测试。
- 开发板：稳定性差，主要用于尽快修复缺陷和敏捷上线小的特性。


> 注意事项：微信开发者工具必须联网使用！！！！

- 下载：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
- 安装
- 扫码登录






### 设置外观和代理
![image](/imgs/applet/wx/wx2.png)



### 创建小程序项目

<!-- ![image](/imgs/applet/wx/wx3.png) -->

![image](/imgs/applet/wx/wx3_1.png)
![image](/imgs/applet/wx/wx3_2.png)



### 查看项目效果

#### 在模拟器上查看项目效果
![image](/imgs/applet/wx/wx4.png)

#### 在真机上预览项目效果
![image](/imgs/applet/wx/wx5.png)


### 主界面的5个组成部分
![image](/imgs/applet/wx/wx6.png)




> 微信开发者工具缓存非常严重。
>
> 如果发现代码和预期不一样，先点击编译。
>
> 编译后还是没有达到预期的效果，就需要清除缓存，甚至重启项目才可以。


## 小程序代码的构成

### 项目结构


一个完整的小程序项目分为两个部分：主体文件、页面文件
- 主体文件，又称全局文件，能够作用于整个小程序，影响到小程序的每个页面，主体文件必须放到项目的根目录下。主体文件由三部分组成：
  - `app.js`:小程序入口文件
  - `app.json`：小程序的全局配置文件
  - `app.wxss`：小程序的全局样式
  
  ![image](/imgs/applet/wx/wx7_1.png)

> 注意事项：主体文件名字必须是`app`开头，`app.js`和`app.json`文件是必须的。


其它：
- `pages`：用来存放所有小程序的页面
- `components`：用来存放公共组件的
`.json`结尾的配置文件：
- `project.config.json`：项目的配置文件
- `sitemap.json`：用来配置小程序及页面是否允许被微信索引
- `project.private.config.json`：配置文件



- 页面文件，是每个页面所需要的文件，小程序页面文件都存放在`pages`目录下，一个页面一个文件夹。每个页面通常由四个文件组成，每个文件只对当前页面有效：
  - `.js`：页面逻辑（页面的脚本文件，存放页面的数据、事件处理函数等）
  - `.wxml`：页面结构（页面的模板结构文件）
  - `.wxss`：页面样式（当前页面的样式表文件）
  - `.json`：小页面配置（当前页面的配置文件，配置窗口的外观、表现等）

![image](/imgs/applet/wx/wx7_2.png)

小程序官方建议把所有小程序的页面，都存放在`pages`目录中，以单独的文件夹存在，如图所示：
![image](/imgs/applet/wx/wx7.png)


> 注意事项：`.js`和`.wxml`文件是必须的。



**渲染模式处理**
默认调试器会有如下提示信息
![image](/imgs/applet/wx/wx7_3.png)

切换为WebView的渲染模式方式：将`app.json`中的`renderer`、`rendererOptions`、`componentFramework`三个属性删掉即可。
![image](/imgs/applet/wx/wx7_4.png)









### JSON配置文件


**JSON是一种数据格式**，在实际开发中，`JSON`总是以**配置文件**的形式出现。小程序项目中也不例外：通过不同的`.json`配置文件，可以对小程序项目进行不同级别的配置。

`JSON`是一种轻量级的数据格式，常用于前后端数据的交互，但是在小程序中，**JSON扮演的配置项的角色**，用于配置项目或者页面属性和行为，每个页面或组件也都有一个对应的`json`文件。



小程序项目中有4种json配置文件，分别是：
- 项目根目录中的`app.json`配置文件（全局配置文件）
- 项目根目录中的`project.config.json`/`project.private.config.json`配置文件（项目配置文件）
- 项目根目录中的`sitemap.json`配置文件
- 每个页面文件夹中的`.json`配置文件（局部配置文件）


#### （1）app.json文件

[小程序全局配置官方文档](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html)

`app.json`是当前小程序的**全局配置**文件，用于配置小程序的一些全局属性和页面路由，包括了小程序的所有页面路径、窗口外观、界面表现、底部tab等。

Demo项目里边的`app.json`配置内容如下：
![image](/imgs/applet/wx/wx8.png)


配置项的作用：
- `pages`：用来记录当前小程序所有页面的路径
> 在配置pages字段时，有以下注意事项：
> - 页面路由不需要写文件后缀，框架会自动去寻找对应位置的四个文件进行处理
> - 小程序中新增/减少页面，都需要对pages数组进行修改
> - 未指定`entryPagePath`时，数组的第一项代表小程序的初始页面（首页）
- `window`：用于设置小程序的状态栏、导航条、标题、窗口的背景色、文字颜色等

![image](/imgs/applet/wx/wx12_2.png)

- `tabBar`：定义小程序顶部、底部tab栏，用以实现页面之间的快速切换，可以通过`tabBar`配置项指定`tab`栏的表现，以及`tab`切换时显示的对应页面。
> 在配置tabBar字段时，有以下注意事项：
> - tab按数组的顺序排序，list配置最少2个，最多5个tab
>  
![image](/imgs/applet/wx/wx12_3.png)

- `style`:全局定义小程序组件所使用的样式版本
- `sitemapLocation`:用来指明`sitemap.json`的位置




#### （2）`project.config.json` / `project.private.config.json`文件

[小程序项目配置文件官方文档](https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html)

在创建项目的时候，每个项目的根目录生成两个`config.json`文件，用于保存开发者在工具上做的个性配置，例如和编译有关的配置。

当重新安装微信开发者工具或换电脑工作时，只要载入同一个项目的代码包，开发者工具就会自动恢复到当时开发项目时的个性化配置。


项目根目录中的x和`project.private.config.json`文件都可以对项目进行配置
- `project.config.json`：项目配置文件，常用来进行配置公共的配置
- `project.private.config.json`：项目私有配置文件，常用来配置个人的配置

> 注意事项：
> - `project.private.config.json`写到`.gitignore`避免版本管理冲突。
> - 与最终编译结果有关的设置必须设置到`project.config.json`中。



- `setting`中保存了编译相关的配置
- `projectname`中保存的是项目名称
- `appid`中保存的是小程序的账号ID



eg：配置`sass`

在`project.config.json`的`setting`中增加属性，然后将`.wxss`后缀改为`.scss`即可。

```js
"useCompilerPlugins": [
  "sass"
],
```


#### （3）sitemap.json

微信现已开放小程序搜索，效果类似于PC网页的SEO。`sitemap.json`文件用来配置小程序页面是否允许微信索引，提高小程序在搜索引擎搜索到的概率。

微信现已开放小程序内搜索，开发者可以通过`sitemap.json`配置来设置小程序页面是否允许微信索引。当开发者允许微信索引时，微信会通过爬虫的形式，为小程序的页面建立索引。当用户的搜素关键字和页面的索引匹配成功的时候，小程序的页面将可能展示在搜素结果中。

- `page`属性的`*`表示所有页面
- `action`：
  - `allow`:允许索引页面
  - `disallow`：不允许被索引
```js
{
    "desc": "关于本文件的更多信息，请参考文档 https://developers.weixin.qq.com/miniprogram/dev/framework/sitemap.html",
    "rules": [{
    "action": "allow",
    "page": "*"
    }]
}
```

若要将首页设置不可被索引，可以修改配置如下：
```js
{
    "desc": "关于本文件的更多信息，请参考文档 https://developers.weixin.qq.com/miniprogram/dev/framework/sitemap.html",
    "rules": [{
    "action": "disallow",
    "page": "pages/index/index"
    }]
}
```

若只有首页可被索引，其它都不可被索引，可以修改配置如下：
```js
{
    "desc": "关于本文件的更多信息，请参考文档 https://developers.weixin.qq.com/miniprogram/dev/framework/sitemap.html",
    "rules": [{
    "action": "allow",
    "page": "pages/index/index"
    }]
}
```


> 注意：
> - `sitemap`的索引提示是默认开启的，如需要关闭`sitemap`的索引提示，可在小程序项目配置文件`project.config.json`的`setting`中配置字段`checkSiteMap`为`false`
> - 没有`sitemap`则默认所有页面都能被索引
> `{"action":"allow","page":"*"}`是优先级最低的默认规则，未显示指明`disallow`的都默认被索引。


#### （4）页面的`.json`配置文件

[小程序页面配置官方文档](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html)

小程序页面配置文件，也称局部配置文件，用于配置当前页面的窗口样式、页面标题等。

小程序中的每一个页面，可以使用`.json`文件来对本页面的窗口外观进行配置，页面中的配置项会覆盖`app.json`的`window`中相同的配置项。例如：

![image](/imgs/applet/wx/wx10.png)


> 注意：页面配置文件的属性和全局配置文件中的`window`属性几乎一致，只不过这里不需要额外指定`window`字段，因此如果出现相同的配置项，页面中配置项或覆盖全局配置文件中相同的配置项。









## 小程序页面操作


### 新建小程序页面


两种方式：
- 方式1：直接选中`pages`右键->新建文件夹->新建`page`。
- 方式2：在`app.json`->`pages`中新增页面的存放路径。


只需要在`app.json`->`pages`中新增页面的存放路径，小程序开发者工具即可帮我们自动创建对应的页面文件，如图所示：
![image](/imgs/applet/wx/wx11.png)






### 修改项目首页

只需要调整`app.json`->`pages`数组中野蛮路径的前后顺序，即可修改项目的首页。小程序会把排在第一位的页面，当做项目首页进行渲染，如图所示：
![image](/imgs/applet/wx/wx12.png)


### 调试基础库

小程序调试基础库是指微信开发者工具中可以选择的微信基础库版本。

微信基础库是指小程序的运行环境，给小程序提供了运行所需的各种API和工具，以及基础框架和运行逻辑等。

小程序开发者可以在微信开发者工具中选择所需的微信基础库版本，作为运行和调试小程序时的运行环境。

每个小程序有自己所允许使用的基础库最低版本要求，开发者需要选择兼容的基础库版本，从而确保小程序的功能正常运行。


**设置基础库步骤：**

- 新建小程序项目
  
首先，在微信开发者工具中新建一个小程序项目。点击工具栏中的“项目”按钮，选择“新建项目”。填写项目名称、AppID等信息，并选择合适的项目目录。点击确定后，即可成功新建一个小程序项目。

- 点击右上角的详情

在新建的小程序项目中，点击界面右上角的“详情”按钮。进入项目详情页后，可以看到各种项目设置选项。

- 选择本地设置
  
在项目详情页中，找到“本地设置”选项。点击进入本地设置页面，可以进行一些本地调试和配置的设置。

- 找到调试基础库
  
在本地设置页面中，找到“调试基础库”选项。该选项用于设置小程序项目所使用的基础库版本。

- 选择基础库版本
  
点击“调试基础库”下拉框，会显示可选择的基础库版本列表。根据项目的需求和兼容性要求，选择一个合适的基础库版本。选择完成后，保存设置即可。

![image](/imgs/applet/wx/wx12_ 1.png)






## WXML模板


> 在开发Web网站的时候：
> 页面的结构由HTML进行编写，例如：经常会用到`div`、`p`、`span`、`img`、`a`等标签；
> 页面的样式由CSS进行编写，例如：经常会用到`.class`、`#id`、`element`等选择器；
>
> **但在小程序中不能使用HTML标签，也就灭有DOM和BOM，CSS也仅仅支持部分选择器**
>
> **小程序提供了WXML进行页面结构编写，同时提供了WXSS进行页面样式编写**






### 什么是WXML

WXML（WeiXin Markup Language）是小程序框架设计的一套标签语言，用来构建小程序页面的结构，其作用类似于网页开发中的HTML。


WXML提供了`view`、`text`、`image`、`navigator`等标签来构建页面结构，只不过在小程序中将标签称为**组件**。

### WXML和HTML的区别

- 标签名称不同
  - HTML（div，span，img，a）
  - WXML（view，text，image，navigator）
- 属性节点不同
  - `<a href="#">超链接</a>`
  - `<navigator url="/pages/home/home"></navigator>`
- 提供了类似于`Vue`中的模板语法
  - 数据绑定
  - 列表渲染
  - 条件渲染



## WXSS样式

### 什么是WXSS

WXSS（WeiXin Style Sheets）是一套样式语言，用于描述`WXML`的组件样式，类似于网页开发中的`CSS`。

WXSS对CSS扩充和修改，新增了尺寸单位`rpx`，提供了全局的样式和局部样式，另外需要注意的是**WXSS仅支持部分CSS选择器**

### WXSS和CSS的区别
- 新增了`rpx`尺寸单位
  - `CSS`中需要手动进行像素单位换算，例如`rem`
  - `WXSS`在底层支持新的尺寸单位`rpx`,在不同大小的屏幕上小程序会自动进行换算
- 提供了全局的样式和局部样式
  - 项目根目录中的`app.wxss`会作用于所有小程序页面
  - 局部页面的`.wxss`样式仅对当前页面生效
- `WXSS`仅支持部分`CSS`选择器
  - `.class`和`#id`
  - `element`
  - 并集选择器、后代选择器
  - `::after`和`::before`等伪类选择器


WXSS仅仅支持6个选择器,[详情见官网](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html)


## JS逻辑交互

### 小程序中的.js文件

一个项目仅仅提供界面展示是不够的，在小程序中，我们通过`.js`文件来处理用户的操作。例如：响应用户的点击、获取用户的位置等等。

### 小程序中的.js文件分类

小程序中的JS文件分为三大类：分别是：
- `app.js`
  - 是整个小程序项目的入口文件，通过调用`App()`函数来启动整个小程序
- 页面的`.js`文件
  - 是页面的入口文件，通过调用`Page()`函数来创建并运行页面
- 普通的`.js`文件
  - 是普通的功能模块文件，用来封装**公共的函数或属性**供页面使用



## 宿主环境简介

### 什么是宿主环境

宿主环境（host environment）指的是**程序运行所必须的依赖环境**。例如：

`Android系统`和`iOS系统`是两个不同的宿主环境。安卓版的微信`App`是不能在`iOS`环境下运行的，所以，`Android`是安卓软件的宿主环境，**脱离了宿主环境的软件是没有任何意义的**！

![image](/imgs/applet/wx/wx13.png)


### 小程序的宿主环境

手机微信是小程序的宿主环境，如图所示：
![image](/imgs/applet/wx/wx14.png)

> 小程序借助宿主环境提供的能力，可以完成许多普通网页无法完成的功能，例如：微信扫码、微信支付、微信登录、地理定位、etc...


小程序的宿主环境包含的内容
- 通信模型
- 运行机制
- 组件
- API

#### 通信模型

**1.通信的主体**
小程序中通信的主体是**渲染层**和**逻辑层**，其中：
- `WXML`模板和`WXSS`样式工作在渲染层
- `JS`脚本工作在逻辑层
![image](/imgs/applet/wx/wx15.png)


**2.小程序的通信模型**

小程序中的通信模型分为两部分：
- **渲染层**和**逻辑层**之间的通信（由微信客户端进行转发）
- **逻辑层**和**第三方服务器**之间的通信（由微信客户端进行转发）

![image](/imgs/applet/wx/wx16.png)


#### 运行机制

**1.小程序启动的过程**
- 把小程序的代码包下载到本地
- 解析`app.json`全局配置文件
- 执行`app.js`小程序入口文件，调用`App()`创建小程序实例
- 渲染小程序首页
- 小程序启动完成


**2.页面渲染的过程**
- 加载解析页面的`.json`配置文件
- 加载页面的`.wxml`模板和`.wxss`样式
- 执行页面的`.js`文件，调用`Page()`创建页面实例
- 页面渲染完成





## 协同工作

### 了解权限管理需求

在中大型的公司里，人员的分工非常仔细：同一个小程序项目，一般会有不同岗位、不同角色的员工同时参与设计与开发。

此时出于管理需要，我们迫切需要对不同岗位、不同角色的员工的权限进行边界的划分，使他们能够高效的进行协同工作。


### 了解项目成员的组织结构
![image](/imgs/applet/wx/wx26.png)


### 小程序的开发流程
![image](/imgs/applet/wx/wx27.png)


### 小程序成员管理
![image](/imgs/applet/wx/wx28.png)


### 不同项目成员对应的权限
![image](/imgs/applet/wx/wx29.png)


开发者的权限说明：
- 开发者权限：可使用小程序开发者工具及对小程序的功能进行代码开发
- 体验者权限：可使用体验版小程序
- 登录权限：可登录小程序管理后台，无需管理员确认
- 开发设置：设置小程序服务器域名、消息推送及扫描普通链接二维码打开小程序
- 腾讯云管理：云开发相关设置


### 添加项目成员和体验成员
![image](/imgs/applet/wx/wx30.png)



### 小程序的版本
在软件开发过程，根据时间节点的不同，会产出不同的软件版本，例如：
- 开发者编写代码的同时，对项目代码进行自测（开发版本）
- 直到程序达到一个稳定可体验的状态时，开发者把体验版本给到产品经理和测试人员进行体验测试
- 最后修复完程序的Bug后，发布正式版供外部用户使用


小程序的版本如下：
![image](/imgs/applet/wx/wx31.png)


## 发布上线整体步骤
一个小程序的发布上线，一般要经过`上传代码`->`提交审核`->`发布`这三个步骤。

![image](/imgs/applet/wx/wx195.png)

- 开发版本：点击开发者工具上传后的般般，开发版本只保留每人最新的一份上传的代码，是供开发者和团队测试和调试的版本。
- 体验版本：小程序开发者可以将开发版本转为体验版本，由测试人员以及产品经理进行测试与体验，确认没问题可提交审核。
- 审核版本：小程序开发者可以将开发版本转为审核版本，由微信的审核团队进行审核，审核周期为1~7天，审核通过可提交发布。
- 线上版本：通过微信小程序平台审核，并由开发者提交发布的正式版本，线上版本是用户可以正常使用的小程序版本。


### 上传代码
- 点击开发者工具顶部工具栏中的"上传"按钮
- 填写版本号以及项目备注

![image](/imgs/applet/wx/wx32.png)

> 在后台查看上传之后的版本
> 登录小程序管理后台->管理->版本管理->开发版本，即可查看刚才提交的版本了

![image](/imgs/applet/wx/wx33.png)



### 提交审核
- 为什么需要提交审核：为了保证小程序的质量，以及符合相关的规范，小程序的发布是需要经过腾讯官方审核的。
- 提交审核的方式：在开发版本的列表中，点击"提交审核"按钮之后，按照页面提示填写相关的信息，就能把小程序提交到腾讯官方进行审核。

![image](/imgs/applet/wx/wx34.png)


### 发布
审核通过之后，管理员的微信中会收到小程序通过审核的通知，此时在审核版本的列表中，点击"**发布**"按钮之后，即可把"**审核通过**"的版本发布为"**线上版本**"，供所有小程序用户访问和使用。

![image](/imgs/applet/wx/wx35.png)



### 推广

基于小程序码进行推广

相对于普通二维码来说，小程序码的优势如下：
- 在样式上具有**辨识度**和**视觉冲击力**
- 能够更加清晰地树立小程序的品牌形象
- 可以帮助开发者更好地推广小程序


获取小程序码的5个步骤：
> 登录小程序管理后台->设置->基本设置->基本信息->小程序码及线下物料下载







## 运营数据

查看小程序运营数据的两种方式

（1）在“小程序后台”查看
- 登录小程序管理后台
- 点击侧边栏的“统计”
- 点击相应的tab可以看到相关的数据
![image](/imgs/applet/wx/wx36.png)

（2）使用“小程序数据助手”查看
- 打开微信
- 搜素“小程序数据助手”
- 查看已发布的小程序相关的数据


## 自定义编译模式
![image](/imgs/applet/wx/wx108.png)