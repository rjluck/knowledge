# 插件

[[toc]]

## 使用npm包

### 小程序对npm的支持与限制

目前，小程序中已经支持使用`npm`安装第三方包，从而提高小程序的开发效率。但是，在小程序中使用`npm`包有如下3个限制：
- 不支持依赖于`Node.js`内置库的包
- 不支持依赖于浏览器内置对象的包
- 不支持依赖于`C++`插件的包

> 总结：虽然npm上的包有千千万，但是能供小程序使用的包却“为数不多”


### Vant Weapp

#### 什么是Vant Weapp

`Vant Weapp`是有赞前端团队开源的一套**小程序UI组件库**，助力开发者快速搭建小程序应用。它所使用的是`MIT开源许可协议`，对商业使用比较友好。

官方文档地址：https://youzan.github.io/vant-weapp

#### 安装Vant Weapp组件库
在小程序项目中，安装`Vant`组件库主要分为如下3步：
- 通过npm安装（建议指定版本为@1.3.3）
- 构建npm包
- 修改app.json

详细步骤：https://youzan.github.io/vant-weapp/#/quickstart


#### 使用Vant Weapp 组件
安装完Vant Weapp组件库之后，可以在`app.json`的`usingComponents`节点中引入需要的组件，即可在wxml中直接使用组件。示例代码如下：
![image](/imgs/applet/wx/wx159.png)


#### 定制全局主题样式

（1）CSS变量
Vant Weapp 使用**CSS变量**来实现定制主题。关于CSS变量的基本用法，请参考MDN文档：https://developer.mozilla.org/zh-CN/docs/Web/CSS/Using_CSS_custom_properties

![image](/imgs/applet/wx/wx160.png)
![image](/imgs/applet/wx/wx161.png)


（2）app.wxss写入CSS变量
在`app.wxss`中，写入`CSS`变量，即可对全局生效：
![image](/imgs/applet/wx/wx162.png)

官网：https://youzan.github.io/vant-weapp/#/theme下的【配置文件】


## 分包

###  定义
分包指的是把一个**完整的小程序项目**，按照需求**划分不同的子包**，在构建时打包成不同的分包，用户在使用时**按需进行加载**。


分包的好处：
- 可以**优化小程序首次启动的下载时间**
- 在多团队共同开发时可以更好的**解耦协作**


### 分包前项目的构成
 分包前，小程序项目中**所有的页面**和资源都被打包到了一起，导致整个项目体积过大，影响小程序首次启动的下载时间。
 ![image](/imgs/applet/wx/wx171.png)


### 分包后项目的构成
 分包后，小程序项目由**1个主包+多个分包**组成：
 - 主包：一般只包含项目的**启动页面**或**tabBar页面**、以及所有分包都需要用到的一些**公共资源**
 - 分包：只包含和当前分包有关的页面和私有资源

  ![image](/imgs/applet/wx/wx172.png)

### 分包的加载规则

- 在小程序启动时，默认会**下载主包**并**启动主包内页面**
  - `tabBar`页面需要放到主包中
- 当用户进入分包内某个页面时，**客户端会把对应分包下载下来**，下载完成后再进行展示
  - 非`tabBar`页面可以按照功能的不同，划分为不同的分包之后，进行按需下载


### 分包的体积限制
目前，小程序分包的大小有以下两个限制
- 整个小程序所有分包大小不超过**16M**(主包+所有分包)
- 单个分包/主包大小不能超过**2M**


### 使用分包

#### 配置方法
- app.json中配置属性`subpackages`

  ![image](/imgs/applet/wx/wx173.png)


#### 打包原则
- 小程序会按`subpackages`的配置进行分包，`subpackages`之外的目录将被打包到主包中
- 主包也可以有自己的`pages`(即最外层的`pages`字段)
- `tabBar`页面必须在主包内
- 分包之间不能互相嵌套


#### 引用原则
- 主包无法引用分包内的私有资源
- 主包之间不能相互引用私有资源
- 分包可以引用主包内的公共资源


### 独立分包

#### 定义

独立分包本质上也是分包，只不过它比较特殊，**可以独立于主包和其他分包而单独运行**。

![image](/imgs/applet/wx/wx174.png)

#### 独立分包和普通分包的区别

最主要的区别：**是否依赖于主包才能运行**
- 普通分包必须依赖于主包才能运行
- 独立分包可以在不下载主包的情况下，独立运行

#### 独立分包的应用场景
开发者可以按需，将某些**具有一定功能独立性的页面**配置到**独立分包**中。原因如下：
- 当小程序从普通的分包页面启动时，需要首先下载主包
- 而独立分包**不依赖主包**即可运行，**可以很大程度上提升分包页面的启动速度**

> 注意：一个小程序中可以有多个独立分包

#### 独立分包的配置方法
- 比普通分包的配置多了一个`independent:true`
![image](/imgs/applet/wx/wx175.png)



#### 引用规则
独立分包和普通分包以及主包之间，是**相互隔离**的，**不能相互引用彼此的资源**
- 主包无法引用独立分包内的私有资源
- 独立分包之间，不能相互引用私有资源
- 独立分包和普通分包之间，不能相互引用私有资源
- **特别注意**：独立分包中不能引用主包内的公共资源







### 分包预下载


分包预下载指的是：在进入小程序的某个页面时，**由框架自动预下载可能需要的分包**，从而提升进入后续分包页面时的启动速度。


#### 配置分包预下载
**预下载分包的行为，会在进入指定的页面时触发**。在`app.json`中，使用`preloadRule`节点定义分包的预下载规则，示例代码如下：

![image](/imgs/applet/wx/wx176.png)


#### 分包预下载的限制
同一个分包中的页面享有**共同的预下载大小限额2M**，例如：
![image](/imgs/applet/wx/wx177.png)
